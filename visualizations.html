<!DOCTYPE HTML>
<script language="JavaScript" type="text/javascript" src="./jquery-3.5.1.min.js"></script>
<!-- <script src="visualizations.js"></script> -->
<html>
<head>  
<script>
var link = 'https://en.wikipedia.org/w/api.php?action=parse&page=List_of_Major_League_Baseball_no-hitters&prop=text&formatversion=2&format=json'
var no_hitters = [];
var perfect_games = [];

function main(fchart, fdata){
	$.get(`https://cors-anywhere.herokuapp.com/${link}`, 
		function(p){
			var text = p.parse.text
			var table = $(text).find('table')[1];
			var rows = $(table).find('tr')
			$(rows).each(function() {
				let obj = {}
				let row = $(this).find('td,th')
				if ($(row[0]).text() != "#\n"){
					let color = row[2].style.backgroundColor;
					obj.hof = color == "rgb(255, 255, 187)";
					obj.active = color == "rgb(207, 236, 236)";
					let date = new Date($(row[1]).text());
					obj.date = date;
					let pitchers = [];
					$(row[2]).find('a').each(function(){pitchers.push($(this).text())});
					obj.pitcher = pitchers.length == 1 ? pitchers[0] : pitchers;
					obj.team = $(row[3]).text();
					obj.score = $(row[4]).text();
					obj.oppTeam = $(row[5]).text();
					obj.oppScore = $(row[6]).text();
					obj.league = $(row[7]).text();
					let catchers = [];
					$(row[8]).find('a').each(function(){catchers.push($(this).text())});
					obj.catcher = catchers.length == 1 ? catchers[0] : catchers;
					let perfect = $(row[2]).find('i').length > 0;
					obj.perfect = perfect;
					no_hitters.push(obj);
					if (perfect)
						perfect_games.push(obj);
				}
			
		});
			/**********************DO STUFF HERE*****************************/
			line_graph(line_data(no_hitters), 'No-hitter');
			line_graph(line_data(perfect_games), 'Perfect Game')
	});
}

function line_graph(data, type) {
	var chart = new CanvasJS.Chart(`${type} line`, {
		animationEnabled: true,
		title:{text:`${type}s by Year`},
		axisX:{interval: 10,title:"Year"},
		axisY:{title:"Count"},
		data: [{type: "line",name: "year",axisYType: "primary",color: "#014D65",dataPoints: data}]
	});
	chart.render();
}

function line_data(no_hitters){
	let data = {};
	for (let i = 1875; i <= (new Date()).getFullYear(); i++){
		data[i] = 0
	}
	for (let i = 0; i < no_hitters.length; i++){
		let nono = no_hitters[i];
		let year = nono.date.getFullYear();
		data[year] += 1;
	}
	let output = [];
	let keys = Object.keys(data);
	for (let i = 0; i < keys.length; i++){
		output.push({'y':data[keys[i]], 'label':keys[i]});
	}
	return output;
}


window.onload = main(line_graph, line_data)
</script>
</head>
<body style="height: 100%">
<div id="No-hitter line" style="height: 45vh; width: 100%;"></div>
<div id="Perfect Game line" style="height: 45vh; width: 100%;"></div>
TODO: more visualizations
<script src="canvasjs.min.js"></script>
</body>
</html>